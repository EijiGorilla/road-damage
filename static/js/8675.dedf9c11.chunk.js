"use strict";(self.webpackChunkroad_damage=self.webpackChunkroad_damage||[]).push([[8675,5840],{45840:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>u});var a=i(85504),n=i(16770);class l{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let a=this._inFlightResourceMap.get(e);return a?a.then((e=>({width:e.width,height:e.height}))):(a=(0,n.M5)(e,t),this._inFlightResourceMap.set(e,a),a.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,a.Al)(e)}}var r=i(16355),s=i(67855),o=i(48988),h=i(97763);const c=96/72;class u{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new l}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,a,n,l,r,c,u){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;l||(l=(0,h.n5)(y));const m=await o.$.resolveSymbolOverrides(d,t,this._spatialReference,n,l,r,c),w=this._cimResourceManager,p=[];s.wp.fetchResources(m,w,p),s.wp.fetchFonts(m,w,p),p.length>0&&await Promise.all(p);const{width:f,height:M}=i,v=g(l,f,M,a),b=s.wp.getEnvelope(m,v,w);if(!b)return null;let R=1,C=0,_=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;b.width>f&&(e=f/b.width);let t=1;b.height>M&&(t=M/b.height),"preview"===a&&(b.width<f&&(e=f/b.width),b.height<M&&(t=M/b.height)),R=Math.min(e,t),C=b.x+b.width/2,_=b.y+b.height/2}break;case"CIMLineSymbol":{(u||b.height>M)&&(R=M/b.height),_=b.y+b.height/2;const e=b.x*R+f/2,t=(b.x+b.width)*R+f/2,{paths:i}=v;i[0][0][0]-=e/R,i[0][2][0]-=(t-f)/R}break;case"CIMPolygonSymbol":{C=b.x+b.width/2,_=b.y+b.height/2;const e=b.x*R+f/2,t=(b.x+b.width)*R+f/2,i=b.y*R+M/2,a=(b.y+b.height)*R+M/2,{rings:n}=v;e<0&&(n[0][0][0]-=e,n[0][3][0]-=e,n[0][4][0]-=e),i<0&&(n[0][0][1]+=i,n[0][1][1]+=i,n[0][4][1]+=i),t>f&&(n[0][1][0]-=t-f,n[0][2][0]-=t-f),a>M&&(n[0][2][1]+=a-M,n[0][3][1]+=a-M)}}const S={type:"cim",data:{type:"CIMSymbolReference",symbol:m}};return this.rasterize(S,f,M,C,_,R,l,1,v)}rasterize(e,t,i,a,n,l,s){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d,m=this._canvas,w=(window.devicePixelRatio||1)*c;m.width=t*w,m.height=i*w,s||(s=(0,h.n5)(y)),u||(u=g(s,t,i,"legend")),m.width+=2*o,m.height+=2*o;const p=m.getContext("2d",{willReadFrequently:!0}),f=r.IT.createIdentity();return f.translate(-a,-n),f.scale(l*w,-l*w),f.translate(t*w/2+o,i*w/2+o),p.clearRect(0,0,m.width,m.height),new r.Rj(p,this._cimResourceManager,f,!0).drawSymbol(y,u),p.getImageData(0,0,m.width,m.height)}}function g(e,t,i,a){const n=-t/2+1,l=t/2-1,r=i/2-1,s=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[l,0]]]};default:return"legend"===a?{rings:[[[n,r],[l,0],[l,s],[n,s],[n,r]]]}:{rings:[[[n,r],[l,r],[l,s],[n,s],[n,r]]]}}}},28675:(e,t,i)=>{i.d(t,{previewCIMSymbol:()=>w});var a=i(76931),n=i(67855),l=i(45840),r=i(48988),s=i(97763),o=i(65709),h=i(26291);const c=new l.CIMSymbolRasterizer(null),u=(0,a.PN)(o.CB.size),g=(0,a.PN)(o.CB.maxSize),d=(0,a.PN)(o.CB.lineWidth),y=1;async function m(e,t,i){const a=null===t||void 0===t?void 0:t.size;let l=null!=a&&"object"==typeof a&&"width"in a?a.width:a,s=null!=a&&"object"==typeof a&&"height"in a?a.height:a;if(null==l||null==s)if("esriGeometryPolygon"===i)l=u,s=u;else{const a=await async function(e,t,i){const{feature:a,fieldMap:l,viewParams:s}=t.cimOptions||t,o=await r.$.resolveSymbolOverrides(e.data,a,null,l,i,null,s);if(!o)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:o},e.data.primitiveOverrides=void 0;const h=[];return n.wp.fetchResources(o,c.resourceManager,h),n.wp.fetchFonts(o,c.resourceManager,h),h.length>0&&await Promise.all(h),n.wp.getEnvelope(o,null,c.resourceManager)}(e,t,i);a&&(l=a.width,s=a.height),"esriGeometryPolyline"===i&&(l=d),l=null!=l&&isFinite(l)?Math.min(l,g):u,s=null!=s&&isFinite(s)?Math.max(Math.min(s,g),y):u}return"legend"===t.style&&"esriGeometryPolyline"===i&&(l=d),{width:l,height:s}}async function w(e){var t,i,n;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{node:r,opacity:o,symbolConfig:u}=l,g=null!=u&&"object"==typeof u&&"isSquareFill"in u&&u.isSquareFill,d=l.cimOptions||l,y=d.geometryType||(0,s.n5)(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.symbol),w=await m(e,l,y),{feature:p,fieldMap:f}=d,M=g||"esriGeometryPolygon"!==y?"preview":"legend",v=await c.rasterizeCIMSymbolAsync(e,p,w,M,f,y,null,d.viewParams,d.allowScalingUp);if(!v)return null;const{width:b,height:R}=v,C=document.createElement("canvas");C.width=b,C.height=R,C.getContext("2d").putImageData(v,0,0);const _=(0,a.Lz)(w.width),S=(0,a.Lz)(w.height),I=new Image(_,S);I.src=C.toDataURL(),I.ariaLabel=null!==(i=l.ariaLabel)&&void 0!==i?i:null,I.alt=null!==(n=l.ariaLabel)&&void 0!==n?n:"",null!=o&&(I.style.opacity="".concat(o));let P=I;if(null!=l.effectView){const e={shape:{type:"image",x:0,y:0,width:_,height:S,src:I.src},fill:null,stroke:null,offset:[0,0]};P=(0,h.fz)([[e]],[_,S],{effectView:l.effectView,ariaLabel:l.ariaLabel})}return r&&P&&r.appendChild(P),P}}}]);
//# sourceMappingURL=8675.dedf9c11.chunk.js.map